# config.yaml
common:
  log_level: error
  log_format: console

operations:
  - command: ["audit"]
    with: &audit_defaults
      roots:
        - ~/Development
      debug: false

  - command: ["packages", "delete"]
    with: &packages_purge_defaults
      # package: my-image  # Optional override; defaults to the repository name
      roots:
        - ~/Development

  - command: ["prs", "delete"]
    with: &branch_cleanup_defaults
      remote: origin
      limit: 100
      dry_run: false
      roots:
        - ~/Development

  - command: ["remote", "update-to-canonical"]
    with: &repo_remotes_defaults
      dry_run: false
      assume_yes: true
      owner: canonical
      roots:
        - ~/Development

  - command: ["remote", "update-protocol"]
    with: &repo_protocol_defaults
      dry_run: false
      assume_yes: true
      roots:
        - ~/Development
      from: https
      to: git

  - command: ["folder", "rename"]
    with: &repo_rename_defaults
      dry_run: false
      assume_yes: true
      require_clean: true
      include_owner: false
      roots:
        - ~/Development

  - command: ["workflow"]
    with: &workflow_command_defaults
      roots:
        - ~/Development
      dry_run: false
      assume_yes: false

  - command: ["branch-refresh"]
    with: &branch_refresh_defaults
      roots:
        - ~/Development

  - command: ["branch-default"]
    with: &branch_default_defaults
      debug: false
      roots:
        - ~/Development

workflow:
  - step:
      order: 1
      command: ["remote", "update-protocol"]
      with:
        <<: *repo_protocol_defaults

  - step:
      order: 2
      command: ["remote", "update-to-canonical"]
      with:
        <<: *repo_remotes_defaults

  - step:
      order: 3
      command: ["folder", "rename"]
      with:
        <<: *repo_rename_defaults

  - step:
      order: 4
      command: ["branch-default"]
      with:
        <<: *branch_default_defaults
        targets:
          - remote_name: origin
            target_branch: master
            push_to_remote: true
            delete_source_branch: false

  - step:
      order: 5
      command: ["audit", "report"]
      with:
        output: ./reports/audit-latest.csv
