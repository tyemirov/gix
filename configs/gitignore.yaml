workflow:
  - step:
      name: switch-master
      command: ["tasks", "apply"]
      with:
        tasks:
          - name: "Switch to master if clean"
            actions:
              - type: branch.change
                options:
                  branch: master
                  remote: origin
                  create_if_missing: false
            safeguards:
              require_clean: true

  - step:
      name: gitignore-apply
      after: ["switch-master"]
      command: ["tasks", "apply"]
      with:
        tasks:
          - name: "Ensure gitignore entries"
            safeguards:
              paths:
                - ".gitignore"
            steps:
              - files.apply
            files:
              - path: .gitignore
                content: |
                  # Managed by gix gitignore workflow
                  .env
                  tools/
                  bin/
                mode: append-if-missing

  - step:
      name: gitignore-stage-commit
      after: ["gitignore-apply"]
      command: ["git", "stage-commit"]
      with:
        paths:
          - ".gitignore"
        commit_message: "chore: ensure gitignore entries"

  - step:
      name: gitignore-open-pr
      after: ["gitignore-stage-commit"]
      command: ["pull-request", "open"]
      with:
        branch: "master"
        title: "chore({{ .Repository.Name }}): ensure gitignore entries"
        body: |
          Ensure `.gitignore` contains the standard secrets/tooling entries (.env, tools/, bin/).
        base: "{{ .Repository.DefaultBranch }}"
